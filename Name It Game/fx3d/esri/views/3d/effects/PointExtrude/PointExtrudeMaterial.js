/**
 * Copyright @ 2019 Esri.
 * All rights reserved under the copyright laws of the United States and applicable international laws, treaties, and conventions.
 */
define(["dojo/text!./PointExtrudeMaterial.xml","esri/core/declare","../../webgl-engine-extensions/GLSLShader","../../webgl-engine-extensions/GLSLProgramExt","../../support/fx3dUtils","../Materials"],function(i,e,t,r,s,n){var a=e([n],{declaredClass:"esri.views.3d.effects.PointExtrude.PointExtrudeMaterial",constructor:function(i){this._gl=i.gl,this._shaderSnippets=i.shaderSnippets,this._program=null,this._pushState=i.pushState,this._restoreState=i.restoreState,this._viewingMode=i.viewingMode},destroy:function(){this._program&&(this._program.dispose(),delete this._program,this._program=null)},_addDefines:function(i,e){var t="";if(null!=e)if(Array.isArray(e))for(var r=0,s=e.length;r<s;r++){var n=e[r];t+="#define "+n+"\n"}else for(var n in e)t+="#define "+n+"\n";return this._shaderSnippets.defines+"\n"+t+i},loadShaders:function(){if(this._shaderSnippets){null!=this._shaderSnippets.pointExtrudeVS&&null!=this._shaderSnippets.pointExtrudeFS||this._shaderSnippets._parse(i);var e=[];"global"==this._viewingMode?e.push("GLOBAL"):e.push("LOCAL");var s=this._addDefines(this._shaderSnippets.pointExtrudeVS,e),n=new t(35633,s,this._gl),a=new t(35632,this._shaderSnippets.pointExtrudeFS,this._gl);this._program=new r([n,a],this._gl)}return this._initResources()},_initResources:function(){return!0},bind:function(i,e){this._program.use(),this._program.uniformMatrix4fv("pm",i.proj),this._program.uniform4fv("em",i.viewport),this._program.uniform3fv("oo",i.lightingData.direction),this._program.uniform4fv("ei",i.lightingData.ambient),this._program.uniform4fv("ps",i.lightingData.diffuse),this._program.uniform4fv("sp",i.lightingData.specular),this._oldTex=this._gl.getParameter(32873);var t=this.getOldActiveUnit(e);i.sm.bind(t+1),this._program.uniform1i("sm",t+1),i.ss.bind(t+2),this._program.uniform1i("ss",t+2),this._program.uniform2fv("eo",i.eo),this._program.uniform2f("si",i.si,i.es),this._program.uniform3fv("ls",i.ls),this._gl.activeTexture(33984+t+3),this._gl.bindTexture(3553,i.me),this._program.uniform1i("me",t+3),this._program.uniform1f("io",i.io),this._program.uniform1f("ie",i.ie),this._program.uniform3fv("sl",i.sl),this._program.uniform1f("im",i.time),this._program.uniform1i("ms",i.reachedRepeatLimit),this._program.uniform1f("pe",i.pe),this._program.uniform1f("os",i.zoom),1!=e._depthTestEnabled&&(this._pushState(["setDepthTestEnabled",e._depthTestEnabled]),e.setDepthTestEnabled(!0)),1!=e._polygonCullingEnabled&&(this._pushState(["setFaceCullingEnabled",e._polygonCullingEnabled]),e.setFaceCullingEnabled(!0)),1029!=e._cullFace&&(this._pushState(["setCullFace",e._cullFace]),e.setCullFace(1029)),1!=e._blendEnabled&&(this._pushState(["setBlendingEnabled",e._blendEnabled]),e.setBlendingEnabled(!0))},bindVec3f:function(i,e,t,r){this._program.uniform3f(i,e,t,r)},bindVec3fv:function(i,e){this._program.uniform3fv(i,e)},bindMat4:function(i,e){this._program.uniformMatrix4fv(i,e)},release:function(i){this._gl.activeTexture(33984+i._activeTextureUnit+1),this._gl.bindTexture(3553,this._oldTex),this._restoreState(i),this._gl.useProgram(null)}});return a});